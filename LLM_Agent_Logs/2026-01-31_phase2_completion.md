# 2026-01-31 日次作業ログ

## 実施したタスク (Phase 2)
### 1. スキャン機能の高度化
- **ROI (Region of Interest) 実装**:
  - `ScanSettings` モデルを拡張し、`singleNarrow` (1D用) と `multiFull` (2D用) のスキャンウィンドウ制御を実装。
  - UI上でターゲット枠を動的に切り替えるオーバーレイ表示。
- **バーコードバリデーション**:
  - `BarcodeValidator` ユーティリティを作成。
  - JAN-13 のチェックデジット検証 (Modulus 10 Wait 3:1) を実装。
  - スタート・ストップキャラクタの有無チェック機能を実装。
- **設定画面 (SettingsScreen)**:
  - スキャン種別 (1Dのみ, 2Dのみ, 両方) を切り替える設定UIを実装。
  - チェックデジット等のバリデーションON/OFF切り替え機能を実装。

### 2. テスト環境の整備
- **テスト画像生成スクリプト**:
  - `tools/generate_barcodes.py` (Python) を作成し、10種類のテストケース（OKコード、CDエラー、パリティエラー等）をプログラムで生成。
  - アセットとして `lib/features/scan/presentation/assets/` に統合。
- **デバッグ機能の拡充**:
  - **デモ機能**: アニレス静止画表示による20秒周期の自動スキャンテスト。
  - **画像選択スキャン**: エミュレータのカメラ不調（Virtual Sceneの問題）を受け、ギャラリーから画像を選んで直接スキャンエンジンに渡すデバッグボタンをAppBarに追加。
  - **エミュレータ転送**: 生成画像を `adb` でエミュレータ上の `/sdcard/Download/` に転送し、画像選択テストを可能にした。

## 決定事項・設計議論
- **デモ/デバッグボタンの配置**: FloatingActionButtonではUIを遮ってしまうため、AppBarのアクション（IconButton）へ移動した。
- **アニメーションの廃止**: デモ画像表示時の「チカチカする」Tween効果を削除し、実用的な静止画表示とした。
- **エミュレータ対策**: Virtual Scene設定が困難な環境向けに、`image_picker` を用いた直接ファイル解析機能をデバッグ用として採用することを決定した。

## 動作確認結果
- エミュレータ (sdk gphone64 x86_64 / Android 14) での動作確認。
- 画像選択機能を用いて10種類のテスト画像をスキャンし、`BarcodeValidator` および `VerifyMaterialUseCase` が期待通りに動作することを確認。
- 音声フィードバック (`correct.mp3`, `incorrect.mp3`) の再生を確認。

## 未解決課題
- 特になし (Phase 2 全て完了)。

## 次回の作業予定 (Phase 3)
- **データ永続化**: スキャン結果をローカルDBに保存し、履歴として閲覧可能にする。
- **ログエクスポート**: 履歴データを外部（メール等）へ送信する機能の基礎。
