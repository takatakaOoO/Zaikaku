# 実装計画書 - Phase 8: ストア審査と公開

**作成日**: 2026-02-01  
**フェーズ**: Phase 8 - Google Play Storeへの公開  
**状態**: 承認済み  
**承認日時**: 2026-02-01 19:09

---

## 目標

Google Play Storeに「材確」アプリを正式公開し、エンドユーザーがダウンロード・利用可能な状態にすること。

---

## User Review Required

> [!IMPORTANT]
> **本フェーズの特性について**:
> - Phase 8は主に**ユーザー様の手作業**が中心となります（Google Play Console上での登録・設定作業）
> - LLMエージェントは、必要なドキュメント・素材の準備、手順ガイドの提供、問題発生時のサポートを行います
> - 審査には数日〜数週間かかる場合があります

> [!WARNING]
> **初回公開時の要件**:
> - Google Playの初回審査では、20人以上のテスターによるクローズドテストが必須となる場合があります
> - 開発者アカウントの身分証明書提出が求められることがあります
> - プライバシーポリシーの公開URL（GitHub Pages等）が必要です

> [!CAUTION]
> **AdMob App IDについて**:
> - ストアアップロード時には、本番用AdMob App IDを`key.properties`に設定し、`--dart-define`で注入する必要があります
> - テスト用IDのままアップロードしないよう注意してください

---

## Proposed Changes

本フェーズでは、コード変更は原則として発生しません。以下の作業を順次実施します。

### ステップ1: 事前準備と最終確認

#### 1.1 リリースビルドの最終確認
- [x] Phase 7で生成したAABファイルの存在確認
  - パス: `build/app/outputs/bundle/release/app-release.aab`
  - サイズ: 約71.2MB
- [x] 本番用AdMob App IDが正しく注入されていることの確認
- [x] ProGuard難読化が有効になっていることの確認

#### 1.2 必要素材の準備確認
- [x] **アプリアイコン**: 512x512px（高解像度版）の準備
  - 既存: `assets/icon/icon.png` (1024x1024) から変換可能
- [x] **スクリーンショット**: 最低2枚、推奨4-8枚
  - 推奨サイズ: 1080x1920px (縦) または 1920x1080px (横)
  - 必要画面: ホーム画面、スキャン画面、履歴画面、製品マスタ画面など (エミュレータにて4枚撮影済)
- [x] **フィーチャーグラフィック**: 1024x500px（オプションだが推奨）
- [x] **プライバシーポリシーURL**: 公開可能なURL
  - 候補: GitHub Pages（公開完了）

**エージェント作業**: スクリーンショット撮影用のエミュレータ起動支援、アイコンリサイズ支援

---

### ステップ2: Google Play Console登録作業（ユーザー実施）

#### 2.1 アプリの作成
- [x] Google Play Consoleにログイン
- [x] 「アプリを作成」をクリック
- [x] 基本情報の入力:
  - **アプリ名**: 材確
  - **デフォルト言語**: 日本語
  - **アプリまたはゲーム**: アプリ
  - **無料または有料**: 無料

#### 2.2 ストアの掲載情報
- [x] **アプリ名**: 材確 - 現場向け材料照合アプリ (設定完了)
- [x] **簡単な説明**（80文字以内）: 設定完了
- [x] **詳しい説明**（4000文字以内）: 設定完了
- [x] **スクリーンショット**: アップロード完了
- [x] **アプリアイコン**: 512x512pxをアップロード完了
- [x] **フィーチャーグラフィック**: 1024x500pxをアップロード完了

#### 2.3 アプリのカテゴリと連絡先
- [ ] **アプリカテゴリ**: ビジネス
- [ ] **メールアドレス**: サポート用メールアドレス
- [ ] **ウェブサイト**（オプション）

#### 2.4 プライバシーとセキュリティ
- [x] **プライバシーポリシーURL**: 公開URLを入力 (完了)
- [ ] **アプリのカテゴリと連絡先情報**
  - アプリの種類: アプリ
  - カテゴリ: ビジネス
  - タグ: バーコードスキャナー、ビジネス、生産性
- [ ] **行政アプリの宣言**: 「いいえ」
- [ ] **金融取引機能の宣言**: 「該当なし」
- [ ] **健康アプリの宣言**: 「該当なし」
- [/] **データの安全性**: (ガイド提供中)
- [x] **広告**: 「はい」で回答
- [x] **アプリのアクセス権限**: 設定完了

#### 2.5 対象ユーザーとコンテンツ
- [x] **対象年齢**: 18歳以上（設定完了）
- [x] **コンテンツレーティング**: 質問票に回答完了

---

### ステップ3: リリースのアップロード（ユーザー実施）

#### 3.1 トラックの選択
- [x] 「製品版」タブを選択 (完了)
- [x] 新しいリリースを作成 (完了)

#### 3.2 AABファイルのアップロード
- [x] `app-release.aab` をアップロード完了

#### 3.3 リリースノートの記入
- [x] 日本語: 記入完了

#### 3.4 リリースの確認と保存
- [x] 「保存」→「次へ」をクリック完了

---

### ステップ4: 審査と公開（ユーザー実施）

#### 4.1 審査への提出
- [x] 審査へ送信 (2026-02-01 22:14 提出済み)
- [ ] 審査開始の通知メールを確認

#### 4.2 審査期間中
- [ ] 審査状況を定期的に確認（通常1-3日、最大7日程度）
- [ ] 審査通過待ち (ステータス: 審査中)
- [ ] 必要に応じて修正対応 (却下された場合)

#### 4.3 公開
- [ ] 審査通過の通知を受信
- [ ] 公開を承認（または自動公開）

---

### ステップ5: 実機検証（USB接続テスト）

#### 5.1 環境構築
- [x] Android端末の「開発者向けオプション」および「USBデバッグ」を有効化 (完了)
- [x] PCとUSBケーブルで接続し、接続を確認 (SC-52B 認識完了)
- [x] 実機へのインストール・起動 (成功)

#### 5.2 機能検証シナリオ
- [x] **スキャン機能 (1D/2Dフィルタ)**: 合格 (2026-02-01)
- [x] **スキャン範囲 (単一)**: 合格 (2026-02-01)
- [ ] **スキャン範囲 (複数/全画面)**: **不合格** (単一と同じ範囲しか読めない) -> 再修正へ
- [ ] **バリデーション (CD/パリティ)**: **不合格** (エラーを検出しなかった) -> 再修正へ
- [ ] **バリデーション (Start/Stop)**: 未検証 (画像不足) -> 画像追加へ
- [/] **音声出力**: 検証中
- [/] **外部連携**: 検証中
- [/] **AdMob**: 検証中

---

## 修正履歴

### ~~[修正計画] スキャン設定の反映とバリデーションフィードバックの改善~~
**状態**: 実施済み・一部不合格あり  
**承認日時**: 2026-02-01 22:45  

~~実機テストで報告された、スキャナーの設定（種別、範囲）が反映されない問題、およびバリデーションエラー時にフィードバックが表示されない不具合を修正します。~~

#### ~~Proposed Changes~~
~~- [x] スキャナー種別フィルタの反映 (MobileScannerController の formats 設定)~~
~~- [x] スキャン範囲の制限 (scanWindow 設定)~~
~~- [x] バリデーションフィードバックの強化 (エラーメッセージと音)~~

---

## [再修正計画] スキャン範囲・バリデーション不具合の解消とテスト画像追加
**状態**: **承認待ち**  
**策定日**: 2026-02-01 23:45

実機テストでの不合格項目（スキャン範囲制限の残留、バリデーション未検知、検証画像不足）を修正します。

### Proposed Changes

#### [Scan Feature] [scan_screen.dart](file:///c:/Users/d-2/OriginalCode/Zaikaku/lib/features/scan/presentation/scan_screen.dart)
- **スキャン範囲の完全リセット**: `ScanRangeMode.multiFull` 選択時に、エンジン（`MobileScannerController`）に明示的に `updateScanWindow(null)` を発行し、中央の制限を確実に解除します。
- **デモケースの拡充**: Start/Stopキャラクタエラーを検証するためのデモ画像をアセットリストに追加し、UIから選べるようにします。

#### [Common] [barcode_validator.dart](file:///c:/Users/d-2/OriginalCode/Zaikaku/lib/core/utils/barcode_validator.dart)
- **JAN-8 (EAN-8) 対応**: 8桁のバーコードに対してもチェックデジット検証を行うようにロジックを拡充します。
- **検証ロジックの改善**: 13桁・8桁のチェックデジット計算を厳格化し、数値以外の混入や桁数不足時の検証漏れを防ぎます。

#### [Assets] [generate_barcodes.py](file:///c:/Users/d-2/OriginalCode/Zaikaku/tools/generate_barcodes.py)
- **新規テスト画像追加**: 
    - `demo_8.png`: スタート文字欠落 (MISSING-START)
    - `demo_9.png`: ストップ文字欠落 (MISSING-STOP)
    - `demo_10.png`: 両方欠落 (MISSING-BOTH)
    - `demo_11.png`: JAN-8 CDエラー (49012347 -> 正解は 49012341)

### Verification Plan

#### Manual Verification
1. **実機（SC-52B）での再検証**:
   - 「複数（全画面）」選択時に、中央だけでなく画面端にあるバーコードも即座に読めることを確認。
   - 不正なJAN-8コード（CDエラーあり）で赤いエラー表示が出ることを確認。
   - 追加デモ画像（`demo_8~10`）を選択し、各Start/Stopエラーメッセージが要望通り表示されることを確認。

---

## 次フェーズへの移行条件
<SAME> (既存の条件を維持)
